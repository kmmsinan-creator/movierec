<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Content-Based Movie Recommender</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f2f5f7;color:#222;margin:20px}
    .card{max-width:980px;margin:20px auto;padding:18px;background:white;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    header h1{color:#7a4f3a;margin:0 0 6px 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    select{flex:1;padding:8px;font-size:15px}
    button{padding:9px 14px;font-size:15px;cursor:pointer}
    .result h3{margin-top:12px}
    .recs{display:flex;flex-wrap:wrap;gap:12px;margin-top:8px}
    .rec{width:200px;background:#fafafa;padding:8px;border-radius:6px;border:1px solid #eee}
    .rec img{width:100%;height:300px;object-fit:cover;border-radius:4px}
    .rec .title{font-weight:600;margin-top:6px;font-size:14px}
    .meta{font-size:13px;color:#666}
    footer{font-size:12px;color:#666;margin-top:18px}
  </style>
</head>
<body>
  <div class="card">
    <header><h1>Content-Based Movie Recommender</h1>
      <p>Select a movie and get top similar movies (content-based using overview text).</p>
    </header>

    <div class="controls">
      <select id="movieSelect"></select>
      <button id="getBtn">Get Recommendations</button>
    </div>

    <div id="result" class="result"></div>

    <footer>
      This static page loads <code>recommendations.json</code> generated offline. To update, regenerate the JSON and re-push to GitHub.
    </footer>
  </div>

<script>
async function init(){
  const resp = await fetch('recommendations.json');
  if(!resp.ok) throw new Error('Failed to load recommendations.json: ' + resp.statusText);
  const recs = await resp.json();
  window._recs = recs;
  // Fill select
  const select = document.getElementById('movieSelect');
  // Sort titles alphabetically for easier navigation
  const titles = Object.keys(recs).sort((a,b)=> a.localeCompare(b));
  for (const t of titles){
    const opt = document.createElement('option');
    opt.value = t; opt.textContent = t;
    select.appendChild(opt);
  }
}
function renderRecommendations(title){
  const data = window._recs[title];
  const container = document.getElementById('result');
  if(!data){
    container.innerHTML = '<p>No recommendations found for this title.</p>';
    return;
  }
  const recs = data.recs || [];
  let html = `<h3>Because you liked <em>${escapeHtml(title)}</em>, we recommend:</h3>`;
  if(recs.length === 0){ html += '<p>No similar movies found.</p>'; container.innerHTML = html; return; }
  html += '<div class="recs">';
  for(const r of recs){
    html += '<div class="rec">';
    if(r.poster){
      // If poster is a TMDB relative path, user may need to prefix with TMDB image base url.
      html += `<img src="${escapeHtml(r.poster)}" alt="${escapeHtml(r.title)} poster" onerror="this.style.display=\'none\'">`;
    }
    html += `<div class="title">${escapeHtml(r.title)}</div>`;
    if(r.year || r.score){
      html += `<div class="meta">${r.year ? escapeHtml(r.year) : ''}${(r.year && r.score) ? ' â€¢ ' : ''}${r.score ? 'score: ' + escapeHtml(String(r.score)) : ''}</div>`;
    }
    html += '</div>';
  }
  html += '</div>';
  container.innerHTML = html;
}

// basic escaping
function escapeHtml(str){
  return String(str)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}

document.getElementById('getBtn').addEventListener('click', ()=>{
  const select = document.getElementById('movieSelect');
  renderRecommendations(select.value);
});

init().catch(err=>{
  document.getElementById('result').textContent = 'Initialization error: ' + err;
});
</script>
</body>
</html>
