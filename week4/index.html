<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Two-Tower Retrieval Demo (MovieLens 100K)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <style>
    /* Minimal inline CSS fallback in case style.css missing */
    body{font-family:Arial,Helvetica,sans-serif;background:#111;color:#eee;margin:0}
    header{position:fixed;top:0;width:100%;background:#000;padding:12px 20px;display:flex;align-items:center;gap:20px;z-index:1000}
    .brand{color:#e50914;font-weight:700;font-size:20px}
    main{padding:100px 20px 40px;max-width:1200px;margin:0 auto}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
    button{background:#e50914;border:none;color:#fff;padding:10px 14px;border-radius:6px;cursor:pointer}
    .panel{background:rgba(255,255,255,0.03);border-radius:10px;padding:12px;margin-bottom:16px}
    canvas{background:#0b0b0b;border-radius:6px}
    table{width:100%;border-collapse:collapse}
    td,th{padding:6px;border-bottom:1px solid rgba(255,255,255,0.04)}
  </style>
</head>
<body>
  <header>
    <div class="brand">MovieFlix • Two-Tower Demo</div>
    <div style="margin-left:auto;color:#ccc;font-size:13px">Client-side TF.js demo • Place <code>/data/u.data</code> and <code>/data/u.item</code></div>
  </header>

  <main>
    <section class="panel">
      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
        <button id="btn-load">Load Data</button>
        <button id="btn-train" disabled>Train</button>
        <button id="btn-test" disabled>Test</button>

        <label style="margin-left:12px">Max interactions:
          <input id="cfg-max" type="number" value="80000" min="1000" step="1000" style="width:110px;margin-left:6px">
        </label>
        <label>Embed dim:
          <input id="cfg-dim" type="number" value="32" min="8" max="128" step="8" style="width:70px;margin-left:6px">
        </label>
        <label>Epochs:
          <input id="cfg-epochs" type="number" value="6" min="1" max="50" step="1" style="width:60px;margin-left:6px">
        </label>
        <label>Batch size:
          <input id="cfg-bsz" type="number" value="256" min="8" max="2048" step="8" style="width:80px;margin-left:6px">
        </label>

        <label style="margin-left:12px">Loss:
          <select id="cfg-loss" style="margin-left:6px">
            <option value="inbatch">In-batch Softmax</option>
            <option value="bpr">BPR (pairwise)</option>
          </select>
        </label>

        <label>Use MLP (item features):
          <input id="cfg-mlp" type="checkbox" checked style="margin-left:6px">
        </label>
      </div>

      <p style="color:#bbb;margin-top:10px">
        Tips: Load Data first. Training runs in browser; choose smaller embed dim / fewer epochs for faster runs.
        To host on GitHub Pages put files exactly as: <code>/index.html</code>, <code>/two-tower.js</code>, <code>/app.js</code>, <code>/style.css</code>, and folder <code>/data/u.data</code> & <code>/data/u.item</code>.
      </p>
    </section>

    <section class="panel">
      <div style="display:flex;gap:18px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <h3>Status</h3>
          <div id="status">Idle. Load data to begin.</div>
          <div style="margin-top:10px">
            <button id="btn-clear-log">Clear Log</button>
          </div>
          <pre id="log" style="height:220px;overflow:auto;background:#080808;padding:8px;border-radius:6px;color:#cfcfcf"></pre>
        </div>

        <div style="flex:1.6;min-width:320px">
          <h3>Loss Chart</h3>
          <canvas id="loss-canvas" width="640" height="220"></canvas>
        </div>

        <div style="flex:1;min-width:260px">
          <h3>Embedding Projection (2D)</h3>
          <canvas id="proj-canvas" width="420" height="220"></canvas>
        </div>
      </div>
    </section>

    <section class="panel">
      <h3>Test: Side-by-side comparison</h3>
      <div id="test-area">
        <p>Press <strong>Test</strong> after training to show Top-10 historical vs Top-10 recommended. Deep learning comparison will show a third column (DL recommendations).</p>
        <div id="tables-wrap" style="margin-top:12px"></div>
      </div>
    </section>

    <section class="panel">
      <h3>Sample items</h3>
      <div id="sample-row" style="display:flex;gap:10px;overflow-x:auto;padding:6px"></div>
    </section>
  </main>

  <!-- Scripts: TensorFlow.js, then two-tower core, then app glue -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="two-tower.js"></script>
  <script src="app.js"></script>
</body>
</html>
